<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Origins</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .score-board {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        .conference-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .conference-stats strong {
            color: #333;
        }

        .score {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .question-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .player-name {
            font-size: 26px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .question-text {
            text-align: center;
            color: #666;
            font-size: 16px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .answer-reveal {
            margin-top: 10px;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        .progress-bars {
            display: flex;
            gap: 6px;
            justify-content: center;
            align-items: flex-end;
            margin: 15px 0;
            height: 50px;
        }

        .progress-bar {
            width: 20px;
            background: #e0e0e0;
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        /* Cell phone signal style - each bar gets taller */
        #bar1 {
            height: 15px;
        }

        #bar2 {
            height: 25px;
        }

        #bar3 {
            height: 35px;
        }

        #bar4 {
            height: 45px;
        }

        #bar5 {
            height: 50px;
        }

        .progress-bar.active {
            background: linear-gradient(to top, #667eea 0%, #764ba2 100%);
        }

        .progress-bar.active.current {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .start-screen {
            text-align: center;
        }

        .start-screen p {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.6;
        }

        .start-screen h3 {
            font-size: 20px;
        }

        .mode-button {
            width: 100%;
            max-width: 400px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .player-name {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÄ NBA Origins</h1>
        <p class="subtitle">Test your knowledge of NBA players' backgrounds!</p>

        <!-- Start Screen - Mode Selection -->
        <div id="startScreen" class="start-screen">
            <p>Can you guess which college, country, high school, or G League team each NBA player came from?</p>
            
            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px; color: #333;">üåü Daily Challenge:</h3>
                
                <button class="btn-primary mode-button" onclick="startDailyChallenge()" style="margin-bottom: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); font-size: 18px; font-weight: bold;">
                    üìÖ Daily 5 - Today's Challenge
                </button>
                
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
                
                <h3 style="margin-bottom: 15px; color: #333;">Choose Your Mode:</h3>
                
                <button class="btn-primary mode-button" onclick="selectMode('quick10')" style="margin-bottom: 10px;">
                    üéØ Quick Quiz (10 questions)
                </button>
                
                <button class="btn-primary mode-button" onclick="selectMode('multiplechoice')" style="margin-bottom: 10px;">
                    üé≤ Multiple Choice (10 questions)
                </button>
                
                <button class="btn-primary mode-button" onclick="selectMode('challenge25')" style="margin-bottom: 10px;">
                    üí™ Challenge (25 questions)
                </button>
                
                <button class="btn-primary mode-button" onclick="selectMode('perfect')" style="margin-bottom: 10px;">
                    üî• Perfect Run
                </button>
                
                <button class="btn-primary mode-button" onclick="selectMode('unlimited')" style="margin-bottom: 20px;">
                    ‚ôæÔ∏è Unlimited (practice mode)
                </button>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
                
                <button class="btn-secondary mode-button" onclick="viewMyStats()" style="margin-bottom: 10px;">
                    üìä My Stats (Practice Mode)
                </button>
                
                <button class="btn-secondary mode-button" onclick="viewLeaderboards()">
                    üèÜ View Leaderboards
                </button>

                <!-- Perfect Run Hard Leaderboard Preview -->
                <div id="perfectRunPreview" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="margin-bottom: 10px; font-size: 16px; color: #333;">üî• Perfect Run - Hard</h3>
                    <div id="perfectRunList" style="font-size: 14px; color: #666;">
                        Loading...
                    </div>
                </div>
            </div>
        </div>

        <!-- Difficulty Selection Screen -->
        <div id="difficultyScreen" class="start-screen hidden">
            <button class="btn-secondary" onclick="backToModeSelect()" style="margin-bottom: 20px;">‚Üê Back</button>
            
            <h3 style="margin-bottom: 15px; color: #333;">Choose Difficulty:</h3>
            
            <button class="btn-primary mode-button" onclick="startGame('easy')" style="margin-bottom: 10px; background: #4ade80;">
                üü¢ Easy - All-Stars (Last 3 Years)
            </button>
            
            <button class="btn-primary mode-button" onclick="startGame('medium')" style="margin-bottom: 10px; background: #fbbf24;">
                üü° Medium - 20+ Min Per Game
            </button>
            
            <button class="btn-primary mode-button" onclick="startGame('hard')" style="margin-bottom: 10px; background: #f87171;">
                üî¥ Hard - All Current Players
            </button>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboardScreen" class="start-screen hidden">
            <button class="btn-secondary" onclick="backToModeSelect()" style="margin-bottom: 20px;">‚Üê Back</button>
            
            <h2 style="margin-bottom: 20px;">üèÜ Leaderboards</h2>
            
            <div style="margin-bottom: 15px;">
                <h3 style="margin-bottom: 10px; color: #333;">üéØ Quick Quiz (10)</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <button class="btn-primary" onclick="showLeaderboardForMode('quick10', 'easy')" style="background: #4ade80; padding: 8px 16px;">Easy</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('quick10', 'medium')" style="background: #fbbf24; padding: 8px 16px;">Medium</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('quick10', 'hard')" style="background: #f87171; padding: 8px 16px;">Hard</button>
                </div>

                <h3 style="margin-bottom: 10px; color: #333;">üé≤ Multiple Choice (10)</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <button class="btn-primary" onclick="showLeaderboardForMode('multiplechoice', 'easy')" style="background: #4ade80; padding: 8px 16px;">Easy</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('multiplechoice', 'medium')" style="background: #fbbf24; padding: 8px 16px;">Medium</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('multiplechoice', 'hard')" style="background: #f87171; padding: 8px 16px;">Hard</button>
                </div>

                <h3 style="margin-bottom: 10px; color: #333;">üí™ Challenge (25)</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <button class="btn-primary" onclick="showLeaderboardForMode('challenge25', 'easy')" style="background: #4ade80; padding: 8px 16px;">Easy</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('challenge25', 'medium')" style="background: #fbbf24; padding: 8px 16px;">Medium</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('challenge25', 'hard')" style="background: #f87171; padding: 8px 16px;">Hard</button>
                </div>

                <h3 style="margin-bottom: 10px; color: #333;">üî• Perfect Run</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <button class="btn-primary" onclick="showLeaderboardForMode('perfect', 'easy')" style="background: #4ade80; padding: 8px 16px;">Easy</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('perfect', 'medium')" style="background: #fbbf24; padding: 8px 16px;">Medium</button>
                    <button class="btn-primary" onclick="showLeaderboardForMode('perfect', 'hard')" style="background: #f87171; padding: 8px 16px;">Hard</button>
                </div>
            </div>

            <div id="leaderboardDisplay" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; display: none;">
                <h3 id="leaderboardTitle" style="margin-bottom: 15px;"></h3>
                <div id="leaderboardContent" style="font-family: monospace; white-space: pre-wrap;"></div>
            </div>
        </div>

        <!-- Stats Screen -->
        <div id="statsScreen" class="start-screen hidden">
            <button class="btn-secondary" onclick="backToModeSelect()" style="margin-bottom: 20px;">‚Üê Back</button>
            
            <h2 style="margin-bottom: 20px;">üìä My Stats</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="statsDisplayName" placeholder="Enter your display name" style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                <button class="btn-primary" onclick="loadUserStats()" style="margin-top: 10px;">View My Stats</button>
            </div>
            
            <div id="statsDisplay" style="display: none;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Overall Performance</h3>
                    <div id="overallStats" style="font-size: 18px;"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">NBA Teams</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <h4 style="color: #22c55e; margin-bottom: 10px;">‚úÖ Best Teams</h4>
                            <div id="bestTeams" style="font-size: 14px;"></div>
                        </div>
                        <div>
                            <h4 style="color: #ef4444; margin-bottom: 10px;">‚ùå Weakest Teams</h4>
                            <div id="worstTeams" style="font-size: 14px;"></div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">College Conferences</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <h4 style="color: #22c55e; margin-bottom: 10px;">‚úÖ Best Conferences</h4>
                            <div id="bestConferences" style="font-size: 14px;"></div>
                        </div>
                        <div>
                            <h4 style="color: #ef4444; margin-bottom: 10px;">‚ùå Weakest Conferences</h4>
                            <div id="worstConferences" style="font-size: 14px;"></div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Players to Study</h3>
                    <div id="missedPlayers" style="font-size: 14px;"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="margin-bottom: 15px;">Recent Performance</h3>
                    <div id="recentTrend" style="height: 60px; display: flex; align-items: flex-end; gap: 2px;"></div>
                    <div id="recentStats" style="margin-top: 10px; font-size: 14px;"></div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <div class="score-board">
                <div class="score">
                    Score: <span id="score">0</span> / <span id="total">0</span>
                    <span id="percentage"></span>
                </div>
                <div style="display: flex; gap: 5px; align-items: center; margin-top: 10px;">
                    <button id="slowDownBtn" class="btn-secondary" onclick="adjustSpeed('slower')" style="padding: 5px 10px; font-size: 12px;">üê¢ Slower</button>
                    <span id="speedDisplay" style="font-size: 12px; color: #666; min-width: 40px; text-align: center;">2.0s</span>
                    <button id="speedUpBtn" class="btn-secondary" onclick="adjustSpeed('faster')" style="padding: 5px 10px; font-size: 12px;">üêá Faster</button>
                </div>
            </div>

            <!-- Daily Challenge Progress Bars -->
            <div id="dailyProgressBars" class="progress-bars" style="display: none;">
                <div class="progress-bar" id="bar1"></div>
                <div class="progress-bar" id="bar2"></div>
                <div class="progress-bar" id="bar3"></div>
                <div class="progress-bar" id="bar4"></div>
                <div class="progress-bar" id="bar5"></div>
            </div>

            <!-- Conference Statistics -->
            <div class="conference-stats" id="conferenceStats" style="display: none;">
                <div style="margin-bottom: 15px;">
                    <strong>NBA Conferences:</strong>
                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                        <div style="flex: 1; background: #e8f4f8; padding: 8px; border-radius: 5px; font-size: 13px;">
                            <div style="font-weight: bold;">Eastern</div>
                            <div id="nbaEastern">-</div>
                        </div>
                        <div style="flex: 1; background: #fff4e6; padding: 8px; border-radius: 5px; font-size: 13px;">
                            <div style="font-weight: bold;">Western</div>
                            <div id="nbaWestern">-</div>
                        </div>
                    </div>
                </div>
                <div>
                    <strong>College Conferences:</strong>
                    <div id="collegeConferences" style="margin-top: 5px; font-size: 13px; max-height: 150px; overflow-y: auto;"></div>
                </div>
            </div>

            <div id="feedback" class="feedback"></div>

            <div class="question-card">
                <div class="player-name" id="playerName">-</div>
                <div class="player-team" id="playerTeam" style="font-size: 14px; color: #888; margin-top: 5px; text-align: center;"></div>
                <div class="question-text">Where did this player come from?</div>
            </div>

            <div id="answerSection">
                <input type="text" id="answerInput" placeholder="Enter college, country, high school, etc..." autocomplete="off">
                <button class="btn-primary" onclick="submitAnswer()">Submit Answer</button>
            </div>
            
            <div id="multipleChoiceSection" class="hidden" style="margin-top: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 400px; margin: 0 auto;">
                    <button class="btn-secondary" onclick="submitMultipleChoice(0)" id="choice0" style="padding: 15px; text-align: left; font-size: 14px;"></button>
                    <button class="btn-secondary" onclick="submitMultipleChoice(1)" id="choice1" style="padding: 15px; text-align: left; font-size: 14px;"></button>
                    <button class="btn-secondary" onclick="submitMultipleChoice(2)" id="choice2" style="padding: 15px; text-align: left; font-size: 14px;"></button>
                    <button class="btn-secondary" onclick="submitMultipleChoice(3)" id="choice3" style="padding: 15px; text-align: left; font-size: 14px;"></button>
                </div>
            </div>

            <div id="nextSection" class="hidden">
                <button class="btn-primary" onclick="continueToNext()">Next Question</button>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn-secondary" onclick="restartGame()">Restart Quiz</button>
            </div>
        </div>
    </div>

    <script>
        let sessionId = null;
        let gameMode = null;
        let questionLimit = null;
        let selectedDifficulty = 'hard';  // Default to hard
        let practiceDisplayName = null;  // For tracking practice mode stats
        let autoAdvanceDelay = 2000;  // Default 2 seconds in milliseconds
        let isDailyChallenge = false;  // Track if this is a daily challenge
        let dailyChallengeData = null;  // Store daily challenge info
        let dailyResults = [];  // Track results for sharing
        let gameEnded = false;  // Track if game has ended to prevent extra questions
        let game_sessions = {};  // Store game sessions for daily challenge

        async function startDailyChallenge() {
            try {
                // Check if already completed today
                const completedToday = localStorage.getItem('dailyCompleted_v2');  // v2 to reset
                const today = new Date().toISOString().split('T')[0];
                
                if (completedToday === today) {
                    const previousScore = localStorage.getItem('dailyScore_v2');
                    const previousResults = localStorage.getItem('dailyResults_v2');
                    if (confirm(`You've already completed today's challenge! Score: ${previousScore}/5\n\nWould you like to play again for practice (won't save)?`)) {
                        // Play again without saving
                    } else {
                        // Show share screen
                        if (previousResults) {
                            showDailyResults(JSON.parse(previousResults));
                        }
                        return;
                    }
                }
                
                // Fetch today's challenge
                const response = await fetch('/api/daily-challenge');
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Daily challenge error response:', errorText);
                    throw new Error(`Server returned ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                
                console.log('Daily challenge data:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                if (!data.players || data.players.length < 5) {
                    throw new Error(`Not enough players returned: ${data.players?.length || 0}`);
                }
                
                dailyChallengeData = data;
                isDailyChallenge = true;
                dailyResults = [];
                gameMode = 'daily5';
                questionLimit = 5;
                
                // Start game without difficulty selection
                document.getElementById('startScreen').classList.add('hidden');
                await startGameWithPlayers(data.players, data.question_types);
                
            } catch (error) {
                console.error('Error loading daily challenge:', error);
                alert('Failed to load daily challenge. Please try again.');
            }
        }

        async function startGameWithPlayers(players, questionTypes) {
            // Create a special session with predetermined players
            sessionId = 'daily-' + Date.now();
            
            // Set up game session
            game_sessions[sessionId] = {
                score: 0,
                total: 0,
                players: players,
                questionTypes: questionTypes || Array(players.length).fill('text'),
                currentIndex: 0
            };
            
            // Show game screen
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // Load first question
            await loadDailyQuestion();
        }

        async function loadDailyQuestion() {
            const session = game_sessions[sessionId];
            
            if (session.currentIndex >= session.players.length) {
                // Challenge complete!
                showDailyResults(dailyResults);
                return;
            }
            
            const player = session.players[session.currentIndex];
            const questionType = session.questionTypes[session.currentIndex];
            
            // Update progress bars (cell phone signal style)
            document.getElementById('dailyProgressBars').style.display = 'flex';
            for (let i = 0; i < 5; i++) {
                const bar = document.getElementById(`bar${i + 1}`);
                bar.classList.remove('active', 'current');
                
                if (i < session.currentIndex) {
                    // Completed questions - filled
                    bar.classList.add('active');
                } else if (i === session.currentIndex) {
                    // Current question - filled and pulsing
                    bar.classList.add('active', 'current');
                }
                // Future questions stay gray
            }
            
            // Display player info
            document.getElementById('playerName').textContent = player.name;
            document.getElementById('playerTeam').textContent = player.team;
            
            // Clear previous answer and feedback
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextSection').classList.add('hidden');
            
            // Show appropriate input type
            if (questionType === 'multiplechoice') {
                // Show multiple choice
                document.getElementById('answerSection').classList.add('hidden');
                document.getElementById('multipleChoiceSection').classList.remove('hidden');
                
                // Generate multiple choice options
                const correctAnswer = player.origin;
                const wrongOptions = [];
                
                // Get wrong answers from other players
                for (const otherPlayer of session.players) {
                    if (otherPlayer.name !== player.name && otherPlayer.origin !== correctAnswer) {
                        if (!wrongOptions.includes(otherPlayer.origin)) {
                            wrongOptions.push(otherPlayer.origin);
                        }
                    }
                    if (wrongOptions.length >= 3) break;
                }
                
                // Add generic options if needed
                const genericOptions = ['Duke', 'Kentucky', 'France', 'Spain', 'Australia'];
                for (const option of genericOptions) {
                    if (wrongOptions.length >= 3) break;
                    if (option !== correctAnswer && !wrongOptions.includes(option)) {
                        wrongOptions.push(option);
                    }
                }
                
                // Combine and shuffle
                const allOptions = [correctAnswer, ...wrongOptions.slice(0, 3)];
                allOptions.sort(() => Math.random() - 0.5);
                
                // Populate buttons
                allOptions.forEach((option, index) => {
                    const button = document.getElementById(`choice${index}`);
                    button.textContent = option;
                    button.disabled = false;
                    button.style.opacity = '1';
                });
            } else {
                // Show text input
                document.getElementById('answerSection').classList.remove('hidden');
                document.getElementById('multipleChoiceSection').classList.add('hidden');
                
                // Focus input
                setTimeout(() => {
                    document.getElementById('answerInput').focus();
                }, 100);
            }
        }

        function showDailyResults(results) {
            isDailyChallenge = false;
            
            const score = results.filter(r => r.correct).length;
            const total = results.length;
            
            // Save completion
            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem('dailyCompleted_v2', today);
            localStorage.setItem('dailyScore_v2', `${score}/${total}`);
            localStorage.setItem('dailyResults_v2', JSON.stringify(results));
            
            // Generate shareable text with checkmarks and X's
            const resultEmojis = results.map(r => r.correct ? '‚úÖ' : '‚ùå').join(' ');
            
            const challengeNum = dailyChallengeData.challenge_number;
            
            const shareText = `NBA Origins - Daily 5 #${challengeNum}\n${resultEmojis}\n${score}/5\n\nPlay at: ${window.location.origin}`;
            
            // Show results screen
            const resultHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <h2 style="margin-bottom: 20px;">üìÖ Daily 5 Complete!</h2>
                    <div style="font-size: 36px; margin: 20px 0; letter-spacing: 4px;">${resultEmojis}</div>
                    <div style="font-size: 32px; font-weight: bold; color: #667eea; margin: 20px 0;">
                        ${score}/5
                    </div>
                    <div style="margin: 20px 0; font-size: 14px; color: #666;">
                        Challenge #${challengeNum}
                    </div>
                    <button class="btn-primary" onclick="copyShareText(\`${shareText.replace(/`/g, '\\`')}\`)" style="margin: 10px;">
                        üìã Copy Results
                    </button>
                    <button class="btn-secondary" onclick="restartGame()" style="margin: 10px;">
                        üè† Back to Menu
                    </button>
                    <div id="copyFeedback" style="margin-top: 10px; color: #22c55e; font-weight: bold; display: none;">
                        ‚úì Copied to clipboard!
                    </div>
                </div>
            `;
            
            document.getElementById('gameScreen').innerHTML = resultHTML;
        }

        function copyShareText(text) {
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('copyFeedback').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('copyFeedback').style.display = 'none';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy. Please copy manually:\n\n' + text);
            });
        }

        function adjustSpeed(direction) {
            const speeds = [500, 1000, 2000, 3000, 5000];  // 0.5s, 1s, 2s, 3s, 5s
            const currentIndex = speeds.indexOf(autoAdvanceDelay);
            
            if (direction === 'faster' && currentIndex > 0) {
                autoAdvanceDelay = speeds[currentIndex - 1];
            } else if (direction === 'slower' && currentIndex < speeds.length - 1) {
                autoAdvanceDelay = speeds[currentIndex + 1];
            }
            
            // Update display
            document.getElementById('speedDisplay').textContent = `${(autoAdvanceDelay / 1000).toFixed(1)}s`;
            
            // Update button states
            document.getElementById('speedUpBtn').disabled = (autoAdvanceDelay === 500);
            document.getElementById('slowDownBtn').disabled = (autoAdvanceDelay === 5000);
            
            // Update button styles for disabled state
            if (autoAdvanceDelay === 500) {
                document.getElementById('speedUpBtn').style.opacity = '0.5';
                document.getElementById('speedUpBtn').style.cursor = 'not-allowed';
            } else {
                document.getElementById('speedUpBtn').style.opacity = '1';
                document.getElementById('speedUpBtn').style.cursor = 'pointer';
            }
            
            if (autoAdvanceDelay === 5000) {
                document.getElementById('slowDownBtn').style.opacity = '0.5';
                document.getElementById('slowDownBtn').style.cursor = 'not-allowed';
            } else {
                document.getElementById('slowDownBtn').style.opacity = '1';
                document.getElementById('slowDownBtn').style.cursor = 'pointer';
            }
        }

        function selectMode(mode) {
            gameMode = mode;
            
            // Set question limits based on mode
            switch(mode) {
                case 'quick10':
                    questionLimit = 10;
                    break;
                case 'multiplechoice':
                    questionLimit = 10;
                    break;
                case 'challenge25':
                    questionLimit = 25;
                    break;
                case 'perfect':
                    questionLimit = null; // No limit, but ends on first miss
                    break;
                case 'unlimited':
                    questionLimit = null; // No limit at all
                    break;
            }
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('difficultyScreen').classList.remove('hidden');
        }

        function backToModeSelect() {
            document.getElementById('difficultyScreen').classList.add('hidden');
            document.getElementById('leaderboardScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        function viewLeaderboards() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('leaderboardScreen').classList.remove('hidden');
        }

        function viewMyStats() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('statsScreen').classList.remove('hidden');
        }

        async function loadUserStats() {
            const displayName = document.getElementById('statsDisplayName').value.trim();
            
            if (!displayName) {
                alert('Please enter your display name');
                return;
            }
            
            try {
                const response = await fetch(`/api/user-stats/${encodeURIComponent(displayName)}`);
                const data = await response.json();
                
                if (data.error) {
                    alert(`Error: ${data.error}`);
                    return;
                }
                
                // Show stats display
                document.getElementById('statsDisplay').style.display = 'block';
                
                // Overall stats
                const overall = data.overall;
                document.getElementById('overallStats').innerHTML = `
                    <div style="font-size: 24px; font-weight: bold; color: #667eea;">
                        ${overall.correct} / ${overall.total} (${overall.percentage}%)
                    </div>
                    <div style="color: #666; margin-top: 5px;">Total Questions Answered</div>
                `;
                
                // Best/Worst teams
                const teams = data.teams || [];
                const bestTeams = teams.slice(0, 5);
                const worstTeams = teams.slice(-5).reverse();
                
                document.getElementById('bestTeams').innerHTML = bestTeams.length > 0 
                    ? bestTeams.map(t => `${t.team}: ${t.correct}/${t.total} (${t.percentage}%)`).join('<br>')
                    : 'Not enough data yet';
                    
                document.getElementById('worstTeams').innerHTML = worstTeams.length > 0
                    ? worstTeams.map(t => `${t.team}: ${t.correct}/${t.total} (${t.percentage}%)`).join('<br>')
                    : 'Not enough data yet';
                
                // Best/Worst conferences
                const conferences = data.conferences || [];
                const bestConfs = conferences.slice(0, 5);
                const worstConfs = conferences.slice(-5).reverse();
                
                document.getElementById('bestConferences').innerHTML = bestConfs.length > 0
                    ? bestConfs.map(c => `${c.conference}: ${c.correct}/${c.total} (${c.percentage}%)`).join('<br>')
                    : 'Not enough data yet';
                    
                document.getElementById('worstConferences').innerHTML = worstConfs.length > 0
                    ? worstConfs.map(c => `${c.conference}: ${c.correct}/${c.total} (${c.percentage}%)`).join('<br>')
                    : 'Not enough data yet';
                
                // Most missed players
                const missed = data.missed_players || [];
                document.getElementById('missedPlayers').innerHTML = missed.length > 0
                    ? missed.map(p => `‚ùå ${p.player}: ${p.correct}/${p.attempts} correct`).join('<br>')
                    : '‚úÖ No repeatedly missed players!';
                
                // Recent trend (simple bar chart)
                const history = data.recent_history || [];
                const trendHTML = history.map(h => {
                    const color = h.correct ? '#22c55e' : '#ef4444';
                    return `<div style="width: 8px; height: ${h.correct ? '40px' : '20px'}; background: ${color}; border-radius: 2px;"></div>`;
                }).join('');
                document.getElementById('recentTrend').innerHTML = trendHTML || 'No recent data';
                
                // Recent stats summary
                const recentCorrect = history.filter(h => h.correct).length;
                const recentTotal = history.length;
                const recentPct = recentTotal > 0 ? Math.round(recentCorrect / recentTotal * 100) : 0;
                document.getElementById('recentStats').innerHTML = `Last ${recentTotal} questions: ${recentCorrect}/${recentTotal} (${recentPct}%)`;
                
            } catch (error) {
                console.error('Error loading stats:', error);
                alert('Failed to load stats. Please try again.');
            }
        }

        async function showLeaderboardForMode(mode, difficulty) {
            const leaderboardKey = `${mode}-${difficulty}`;
            
            try {
                const response = await fetch(`/api/leaderboard/${leaderboardKey}`);
                const data = await response.json();
                
                const titleEl = document.getElementById('leaderboardTitle');
                const contentEl = document.getElementById('leaderboardContent');
                const displayEl = document.getElementById('leaderboardDisplay');
                
                const difficultyEmoji = difficulty === 'easy' ? 'üü¢' : difficulty === 'medium' ? 'üü°' : 'üî¥';
                const difficultyName = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
                titleEl.textContent = `${getModeName(mode)} - ${difficultyEmoji} ${difficultyName}`;
                
                if (data.leaderboard && data.leaderboard.length > 0) {
                    let leaderboardHTML = '';
                    
                    data.leaderboard.forEach(entry => {
                        const medal = entry.rank === 1 ? 'ü•á' : entry.rank === 2 ? 'ü•à' : entry.rank === 3 ? 'ü•â' : '  ';
                        leaderboardHTML += `${medal} ${entry.rank}. ${entry.display_name.padEnd(20)} ${entry.score}/${entry.total} (${entry.percentage}%)\n`;
                    });
                    
                    contentEl.textContent = leaderboardHTML;
                } else {
                    contentEl.textContent = 'No scores yet. Be the first!';
                }
                
                displayEl.style.display = 'block';
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                alert('Could not load leaderboard.');
            }
        }

        async function startGame(difficulty) {
            selectedDifficulty = difficulty;
            gameEnded = false;  // Reset game ended flag
            
            // For unlimited mode, prompt for display name
            if (gameMode === 'unlimited') {
                practiceDisplayName = prompt('Enter your display name to track your stats (or click Cancel to skip):');
                if (!practiceDisplayName || practiceDisplayName.trim() === '') {
                    practiceDisplayName = 'Anonymous';
                }
            }
            
            try {
                const response = await fetch('/api/new-game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        difficulty: selectedDifficulty,
                        is_multiple_choice: gameMode === 'multiplechoice'
                    })
                });
                const data = await response.json();
                
                if (data.error) {
                    alert('Error starting game: ' + data.error);
                    return;
                }
                
                sessionId = data.session_id;

                document.getElementById('difficultyScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');

                nextQuestion();
            } catch (error) {
                console.error('Error starting game:', error);
                alert('Failed to start game. Please refresh and try again.');
            }
        }

        async function nextQuestion() {
            // Prevent fetching next question if game has ended
            if (gameEnded) {
                return;
            }
            
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('answerSection').classList.remove('hidden');
            document.getElementById('nextSection').classList.add('hidden');
            document.getElementById('answerInput').value = '';
            
            // Set loading state
            document.getElementById('playerName').textContent = 'Loading...';
            document.getElementById('playerTeam').textContent = '';

            try {
                const response = await fetch('/api/next-question', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ session_id: sessionId })
                });

                const data = await response.json();
                
                if (data.error) {
                    alert('Error: ' + data.error);
                    return;
                }
                
                document.getElementById('playerName').textContent = data.player_name;
                document.getElementById('playerTeam').textContent = data.team || '';
                
                // Handle multiple choice mode
                if (gameMode === 'multiplechoice' && data.multiple_choice_options) {
                    // Hide text input, show multiple choice buttons
                    document.getElementById('answerSection').classList.add('hidden');
                    document.getElementById('multipleChoiceSection').classList.remove('hidden');
                    
                    // Store correct answer for checking
                    window.currentCorrectAnswer = data.correct_answer;
                    
                    // Populate choice buttons
                    data.multiple_choice_options.forEach((option, index) => {
                        const button = document.getElementById(`choice${index}`);
                        button.textContent = option;
                        button.disabled = false;
                        button.style.opacity = '1';
                    });
                } else {
                    // Show text input, hide multiple choice
                    document.getElementById('answerSection').classList.remove('hidden');
                    document.getElementById('multipleChoiceSection').classList.add('hidden');
                }
                
                // Focus input after player name is loaded (only for text mode)
                if (gameMode !== 'multiplechoice') {
                    setTimeout(() => {
                        document.getElementById('answerInput').focus();
                    }, 100);
                }
            } catch (error) {
                console.error('Error loading question:', error);
                document.getElementById('playerName').textContent = 'Error loading player';
                alert('Failed to load question. Please try again.');
            }
        }

        async function handleDailyAnswer(userAnswer) {
            const session = game_sessions[sessionId];
            const player = session.players[session.currentIndex];
            
            // Use backend for proper answer checking
            try {
                const checkResponse = await fetch('/api/check-answer-simple', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_answer: userAnswer,
                        correct_answer: player.origin,
                        player_type: player.type
                    })
                });
                
                const checkData = await checkResponse.json();
                const isCorrect = checkData.correct;
                
                // Track result
                dailyResults.push({
                    player: player.name,
                    correct: isCorrect,
                    userAnswer: userAnswer,
                    correctAnswer: player.origin
                });
                
                // Update session
                session.score += isCorrect ? 1 : 0;
                session.total += 1;
                session.currentIndex += 1;
                
                // Update display
                document.getElementById('score').textContent = session.score;
                document.getElementById('total').textContent = session.total;
                
                // Show feedback
                const feedbackEl = document.getElementById('feedback');
                feedbackEl.style.display = 'block';
                
                if (isCorrect) {
                    feedbackEl.className = 'feedback correct';
                    feedbackEl.innerHTML = `‚úÖ Correct! ${player.origin}`;
                    
                    // Auto-advance or show results
                    setTimeout(() => {
                        if (session.currentIndex >= session.players.length) {
                            showDailyResults(dailyResults);
                        } else {
                            loadDailyQuestion();
                        }
                    }, autoAdvanceDelay);
                } else {
                    feedbackEl.className = 'feedback incorrect';
                    feedbackEl.innerHTML = `‚ùå Incorrect<div class="answer-reveal">You answered: <strong>${userAnswer}</strong><br>The correct answer is: <strong>${player.origin}</strong> (${player.type})</div>`;
                    
                    // Show next button
                    document.getElementById('answerSection').classList.add('hidden');
                    document.getElementById('multipleChoiceSection').classList.add('hidden');
                    document.getElementById('nextSection').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error checking answer:', error);
                alert('Error checking answer. Please try again.');
            }
        }

        function continueToNext() {
            if (isDailyChallenge) {
                const session = game_sessions[sessionId];
                if (session.currentIndex >= session.players.length) {
                    showDailyResults(dailyResults);
                } else {
                    loadDailyQuestion();
                }
            } else {
                nextQuestion();
            }
        }

        async function submitMultipleChoice(choiceIndex) {
            const button = document.getElementById(`choice${choiceIndex}`);
            const selectedAnswer = button.textContent;
            
            // Disable all buttons
            for (let i = 0; i < 4; i++) {
                document.getElementById(`choice${i}`).disabled = true;
            }
            
            // For daily challenge, handle differently
            if (isDailyChallenge) {
                await handleDailyAnswer(selectedAnswer);
                return;
            }
            
            // For regular games, submit as regular answer
            document.getElementById('answerInput').value = selectedAnswer;
            await submitAnswer();
        }

        async function submitAnswer() {
            const answer = document.getElementById('answerInput').value.trim();
            
            if (!answer) {
                alert('Please enter an answer!');
                return;
            }

            // Handle daily challenge differently (client-side only)
            if (isDailyChallenge) {
                await handleDailyAnswer(answer);
                return;
            }

            const response = await fetch('/api/submit-answer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    session_id: sessionId,
                    answer: answer
                })
            });

            const data = await response.json();
            
            // Check for error response
            if (data.error) {
                alert(`Error: ${data.error}`);
                restartGame();
                return;
            }
            
            // Save stats for unlimited mode
            if (gameMode === 'unlimited' && practiceDisplayName && practiceDisplayName !== 'Anonymous') {
                try {
                    await fetch('/api/user-stats/save', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            display_name: practiceDisplayName,
                            player_name: data.player_name || 'Unknown',
                            player_team: data.player_team,
                            nba_conference: data.nba_conference,
                            college_conference: data.college_conference,
                            correct: data.correct ? 1 : 0
                        })
                    });
                } catch (error) {
                    console.error('Failed to save stats:', error);
                }
            }

            // Update score
            document.getElementById('score').textContent = data.score || 0;
            document.getElementById('total').textContent = data.total || 0;
            document.getElementById('percentage').textContent = 
                data.total > 0 ? `(${Math.round(data.score / data.total * 100)}%)` : '';

            // Update conference statistics
            if (data.conference_stats) {
                document.getElementById('conferenceStats').style.display = 'block';
                updateConferenceStats(data.conference_stats);
            }

            // Show feedback
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            
            if (data.correct) {
                feedbackEl.className = 'feedback correct';
                feedbackEl.innerHTML = `‚úÖ Correct! ${data.answer}`;
                
                // Check if game should end
                let gameEnded = false;
                
                // Limited question modes: end when limit reached
                if (questionLimit && data.total >= questionLimit) {
                    gameEnded = true;
                    setTimeout(() => {
                        showGameOver(data.score, data.total);
                    }, autoAdvanceDelay);
                    return;
                }

                // Auto-advance to next question using adjustable delay on CORRECT answer
                setTimeout(() => {
                    nextQuestion();
                }, autoAdvanceDelay);
                
            } else {
                // WRONG ANSWER - Show answer and require manual next
                feedbackEl.className = 'feedback incorrect';
                let confInfo = '';
                if (data.college_conference && data.college_conference !== 'Other') {
                    confInfo = ` (${data.college_conference})`;
                }
                feedbackEl.innerHTML = `‚ùå Incorrect<div class="answer-reveal">You answered: <strong>${answer}</strong><br>The correct answer is: <strong>${data.answer}</strong> (${data.origin_type})${confInfo}</div>`;
                
                // Hide answer input AND multiple choice, show next button
                document.getElementById('answerSection').classList.add('hidden');
                document.getElementById('multipleChoiceSection').classList.add('hidden');
                document.getElementById('nextSection').classList.remove('hidden');
                
                // Check if Perfect Run should end
                if (gameMode === 'perfect') {
                    // Show game over immediately for perfect run
                    gameEnded = true;
                    setTimeout(() => {
                        showGameOver(data.score, data.total);
                    }, 100);
                    return;
                }
                
                // Check if limited question mode should end
                if (questionLimit && data.total >= questionLimit) {
                    gameEnded = true;
                    setTimeout(() => {
                        showGameOver(data.score, data.total);
                    }, 100);
                    return;
                }
            }
        }

        function showGameOver(score, total) {
            const percentage = Math.round(score / total * 100);
            let modeDisplay = '';
            
            switch(gameMode) {
                case 'quick10': modeDisplay = 'Quick Quiz (10)'; break;
                case 'multiplechoice': modeDisplay = 'Multiple Choice (10)'; break;
                case 'challenge25': modeDisplay = 'Challenge (25)'; break;
                case 'perfect': modeDisplay = 'Perfect Run'; break;
                case 'unlimited': modeDisplay = 'Unlimited'; break;
            }
            
            let message = `Game Over!\n\n${modeDisplay}\nFinal Score: ${score}/${total} (${percentage}%)`;
            
            if (gameMode === 'perfect') {
                message = `Perfect Run Ended!\n\nYou got ${score} in a row!`;
            }
            
            // Prompt for leaderboard entry (except unlimited mode)
            if (gameMode !== 'unlimited') {
                message += '\n\nWould you like to save your score to the leaderboard?';
                
                if (confirm(message)) {
                    const displayName = prompt('Enter your display name:', 'Anonymous');
                    if (displayName && displayName.trim()) {
                        saveToLeaderboard(displayName.trim(), score, total);
                    } else {
                        showLeaderboard();
                    }
                } else {
                    showLeaderboard();
                }
            } else {
                alert(message + '\n\nClick OK to return to menu.');
                restartGame();
            }
        }

        async function saveToLeaderboard(displayName, score, total) {
            try {
                const response = await fetch('/api/leaderboard/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        display_name: displayName,
                        game_mode: gameMode,
                        difficulty: selectedDifficulty,
                        score: score,
                        total: total
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('Score saved to leaderboard!');
                }
                
                showLeaderboardAfterGame();
            } catch (error) {
                console.error('Error saving to leaderboard:', error);
                alert('Failed to save score, but you can still view the leaderboard.');
                showLeaderboardAfterGame();
            }
        }

        async function showLeaderboardAfterGame() {
            const leaderboardKey = `${gameMode}-${selectedDifficulty}`;
            
            try {
                const response = await fetch(`/api/leaderboard/${leaderboardKey}`);
                const data = await response.json();
                
                if (data.leaderboard && data.leaderboard.length > 0) {
                    const difficultyEmoji = selectedDifficulty === 'easy' ? 'üü¢' : selectedDifficulty === 'medium' ? 'üü°' : 'üî¥';
                    const difficultyName = selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1);
                    let leaderboardText = `üèÜ LEADERBOARD - ${getModeName(gameMode)} - ${difficultyEmoji} ${difficultyName} üèÜ\n\n`;
                    
                    data.leaderboard.forEach(entry => {
                        leaderboardText += `${entry.rank}. ${entry.display_name}: ${entry.score}/${entry.total} (${entry.percentage}%)\n`;
                    });
                    
                    leaderboardText += '\n\nClick OK to return to menu.';
                    alert(leaderboardText);
                } else {
                    alert('No scores on the leaderboard yet. Be the first!\n\nClick OK to return to menu.');
                }
                
                restartGame();
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                alert('Could not load leaderboard.\n\nClick OK to return to menu.');
                restartGame();
            }
        }

        function getModeName(mode) {
            switch(mode) {
                case 'quick10': return 'Quick Quiz (10)';
                case 'multiplechoice': return 'Multiple Choice (10)';
                case 'challenge25': return 'Challenge (25)';
                case 'perfect': return 'Perfect Run';
                case 'unlimited': return 'Unlimited';
                default: return mode;
            }
        }

        function updateConferenceStats(stats) {
            // Update NBA conferences
            const nbaEastern = stats.nba.Eastern;
            const nbaWestern = stats.nba.Western;
            
            document.getElementById('nbaEastern').textContent = 
                `${nbaEastern.correct}/${nbaEastern.total} (${nbaEastern.total > 0 ? Math.round(nbaEastern.correct/nbaEastern.total*100) : 0}%)`;
            
            document.getElementById('nbaWestern').textContent = 
                `${nbaWestern.correct}/${nbaWestern.total} (${nbaWestern.total > 0 ? Math.round(nbaWestern.correct/nbaWestern.total*100) : 0}%)`;
            
            // Update college conferences
            const collegeConfDiv = document.getElementById('collegeConferences');
            const sortedConferences = Object.entries(stats.college).sort((a, b) => b[1].total - a[1].total);
            
            if (sortedConferences.length === 0) {
                collegeConfDiv.innerHTML = '<div style="color: #999; font-style: italic;">No college players yet</div>';
            } else {
                collegeConfDiv.innerHTML = sortedConferences.map(([conf, data]) => {
                    const percentage = data.total > 0 ? Math.round(data.correct/data.total*100) : 0;
                    return `<div style="padding: 5px; background: white; margin-bottom: 3px; border-radius: 3px;">
                        <strong>${conf}:</strong> ${data.correct}/${data.total} (${percentage}%)
                    </div>`;
                }).join('');
            }
        }

        function restartGame() {
            location.reload();
        }

        // Allow Enter key to submit
        async function loadPerfectRunPreview() {
            try {
                const response = await fetch('/api/leaderboard/perfect/hard');
                const data = await response.json();
                
                const listEl = document.getElementById('perfectRunList');
                
                if (data.length === 0) {
                    listEl.innerHTML = '<div style="color: #999; font-style: italic;">No scores yet. Be the first!</div>';
                    return;
                }
                
                // Show top 5
                const top5 = data.slice(0, 5);
                const html = top5.map((entry, index) => {
                    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                    return `
                        <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
                            <span><strong>${medal}</strong> ${entry.display_name}</span>
                            <span style="color: #667eea; font-weight: bold;">${entry.score}</span>
                        </div>
                    `;
                }).join('');
                
                listEl.innerHTML = html;
            } catch (error) {
                console.error('Error loading Perfect Run preview:', error);
                document.getElementById('perfectRunList').innerHTML = '<div style="color: #999;">Failed to load</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Load Perfect Run - Hard leaderboard preview
            loadPerfectRunPreview();
            
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitAnswer();
                }
            });
        });
    </script>
</body>
</html>
